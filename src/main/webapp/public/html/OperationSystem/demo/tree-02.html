<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>树形结构</title>
    <link rel="stylesheet" href="../../../dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../dist/css/content.css">
    <link rel="stylesheet" href="../../../dist/css/tree.css">
</head>
<body>
    <div class="tree-panel js-tree-panel">
        <div class="tree-content">
            <div class="left full-width">
                    <ul class="tree-list js-tree-list">
                        <!-- 单个单元 -->
                        <li class="list-item js-list-item">
                            <!-- 第一级 -->
                            <div class="item-content js-item-content">
                                <div class="tree-first js-tree-first">
                                    <span class="icon icon-menu-block-right icon-left js-icon-menu"></span>
                                    <span class="text">技术中心</span>
                                    <div class="item-right">
                                        <div class="checkbox-wrap js-checkbox-wrap-all">
                                            <input type="checkbox">
                                            <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                        </div>
                                    </div>
                                </div>
                                <!-- 第一级 END -->
                                <!-- 第二级 -->
                                <div class="tree-second js-tree-second">
                                    <ul class="tree-list js-tree-list">
                                        <!-- 第二级一个单元 -->
                                        <li class="list-item js-list-item">
                                            <div class="item-content js-item-content">
                                                <!-- 第二级内容 -->
                                                <div class="second-content js-second-content">
                                                    <span class="icon icon-menu-block-right icon-left js-icon-menu"></span>
                                                    <span class="text">技术中心</span>
                                                    <div class="item-right">
                                                        <div class="checkbox-wrap js-checkbox-wrap-all">
                                                            <input type="checkbox">
                                                            <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- 第二级内容 END -->

                                                <!-- 第三极 -->
                                                <div class="tree-third js-tree-third">
                                                    <ul class="tree-list js-tree-list">
                                                        <!-- 第三级一个单元 -->
                                                        <li class="list-item js-list-item">
                                                            <div class="item-content js-item-content">
                                                                <!-- 第三级内容 -->
                                                                <div class="third-content js-third-content">
                                                                    <span class="icon icon-menu-block-right icon-left js-icon-menu"></span>
                                                                    <span class="text">技术中心</span>
                                                                    <div class="item-right">
                                                                        <div class="checkbox-wrap js-checkbox-wrap-all">
                                                                            <input type="checkbox">
                                                                            <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- 第三级内容 END -->

                                                                <!-- 第四极 -->
                                                                <div class="tree-fourth js-tree-fourth">
                                                                    <ul class="tree-list js-tree-list">
                                                                        <!-- 第四级一个单元 -->
                                                                        <li class="list-item js-list-item">
                                                                            <div class="item-content js-item-content">
                                                                                <!-- 第四级内容 -->
                                                                                <div class="fourth-content">
                                                                                    <span class="icon icon-menu-block-right icon-left  js-icon-menu"></span>
                                                                                    <span class="text">技术中心</span>
                                                                                    <div class="item-right">
                                                                                        <div class="checkbox-wrap js-checkbox-wrap-all">
                                                                                            <input type="checkbox">
                                                                                            <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <!-- 第四级内容 END -->

                                                                                <!-- 第五级 -->
                                                                                <div class="tree-fifth js-tree-fifth">
                                                                                    <ul class="tree-list js-tree-list">
                                                                                        <li class="list-item js-list-item">
                                                                                            <div class="item-content js-item-content" data-id="1" data-name="黄佳佳">
                                                                                                <span class="text">技术中心</span>
                                                                                                <div class="item-right">
                                                                                                    <div class="checkbox-wrap js-checkbox-wrap">
                                                                                                        <input type="checkbox">
                                                                                                        <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>
                                                                                    </ul>
                                                                                </div>
                                                                                <!-- 第五级 END -->
                                                                            </div>
                                                                        </li>
                                                                        <!-- 第四级一个单元 END -->
                                                                    </ul>
                                                                </div>
                                                                <!-- 第四极 END -->
                                                            </div>
                                                        </li>
                                                        <!-- 第三级一个单元 END -->
                                                    </ul>
                                                </div>
                                                <!-- 第三极 END -->
                                            </div>
                                        </li>
                                        <!-- 第二级一个单元 END -->
                                    </ul>
                                </div>
                                <!-- 第二级 -->

                            </div>

                        </li>
                        <!-- 单个单元 END -->

                        <!-- 单个单元 -->
                        <li class="list-item js-list-item">
                            <!-- 第一级 -->
                            <div class="item-content js-item-content">
                                <div class="tree-first js-tree-first">
                                    <span class="icon icon-menu-block-right icon-left js-icon-menu"></span>
                                    <span class="text">技术中心</span>
                                    <div class="item-right">
                                        <div class="checkbox-wrap js-checkbox-wrap-all">
                                            <input type="checkbox">
                                            <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                        </div>
                                    </div>
                                </div>
                                <ul class="tree-list js-tree-list">
                                    <li class="list-item js-list-item">
                                        <div class="item-content js-item-content"  data-id="1" data-name="黄佳佳">
                                            <span class="text">技术中心</span>
                                            <div class="item-right">
                                                <div class="checkbox-wrap js-checkbox-wrap">
                                                    <input type="checkbox">
                                                    <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <!-- 第一级 END -->

                                <!-- 第二级 -->
                                <div class="tree-second js-tree-second">
                                    <ul class="tree-list js-tree-list">
                                        <!-- 第二级一个单元 -->
                                        <li class="list-item js-list-item">
                                            <div class="item-content js-item-content">
                                                <!-- 第二级内容 -->
                                                <div class="second-content js-second-content">
                                                    <span class="icon icon-menu-block-right icon-left js-icon-menu"></span>
                                                    <span class="text">技术中心</span>
                                                    <div class="item-right">
                                                        <div class="checkbox-wrap js-checkbox-wrap-all">
                                                            <input type="checkbox">
                                                            <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- 第二级内容 END -->

                                                <!-- 第三极 -->
                                                <div class="tree-third js-tree-third">
                                                    <ul class="tree-list js-tree-list">
                                                        <!-- 第三级一个单元 -->
                                                        <li class="list-item js-list-item">
                                                            <div class="item-content js-item-content">
                                                                <!-- 第三级内容 -->
                                                                <div class="third-content js-third-content">
                                                                    <span class="icon icon-menu-block-right icon-left js-icon-menu"></span>
                                                                    <span class="text">技术中心</span>
                                                                    <div class="item-right">
                                                                        <div class="checkbox-wrap js-checkbox-wrap-all">
                                                                            <input type="checkbox">
                                                                            <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- 第三级内容 END -->

                                                                <!-- 第四极 -->
                                                                <div class="tree-fourth js-tree-fourth">
                                                                    <ul class="tree-list js-tree-list">
                                                                        <!-- 第四级一个单元 -->
                                                                        <li class="list-item js-list-item">
                                                                            <div class="item-content js-item-content">
                                                                                <!-- 第四级内容 -->
                                                                                <div class="fourth-content">
                                                                                    <span class="icon icon-menu-block-right icon-left  js-icon-menu"></span>
                                                                                    <span class="text">技术中心</span>
                                                                                    <div class="item-right">
                                                                                        <div class="checkbox-wrap js-checkbox-wrap-all">
                                                                                            <input type="checkbox">
                                                                                            <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <!-- 第四级内容 END -->

                                                                                <!-- 第五级 -->
                                                                                <div class="tree-fifth js-tree-fifth">
                                                                                    <ul class="tree-list js-tree-list">
                                                                                        <li class="list-item js-list-item">
                                                                                            <div class="item-content js-item-content" data-id="1" data-name="黄佳佳">
                                                                                                <span class="text">技术中心</span>
                                                                                                <div class="item-right">
                                                                                                    <div class="checkbox-wrap js-checkbox-wrap">
                                                                                                        <input type="checkbox">
                                                                                                        <label class="checkbox"><span class="glyphicon glyphicon-ok"></span></label>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>
                                                                                    </ul>
                                                                                </div>
                                                                                <!-- 第五级 END -->
                                                                            </div>
                                                                        </li>
                                                                        <!-- 第四级一个单元 END -->
                                                                    </ul>
                                                                </div>
                                                                <!-- 第四极 END -->
                                                            </div>
                                                        </li>
                                                        <!-- 第三级一个单元 END -->
                                                    </ul>
                                                </div>
                                                <!-- 第三极 END -->
                                            </div>
                                        </li>
                                        <!-- 第二级一个单元 END -->
                                    </ul>
                                </div>
                                <!-- 第二级 -->

                            </div>

                        </li>
                        <!-- 单个单元 END -->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script src="../../../dist/js/jquery.min.js"></script>
    <script src="../../../dist/js/common-iframe.js"></script>
    <script>
        $(function () {

            var $body = $('body');

            // 选择单个员工 .js-checkbox-wrap -> 更新右边选择面板中
            $body.on('click', '.js-checkbox-wrap', function () {
                var $this           = $(this),
                    $itemContent    = $this.closest('.js-item-content'),
                    $itemContentAll = $this.parents('.js-item-content'),
                    uid             = $itemContent.attr('data-id'),
                    $selectedList   = $('.js-selected-list'),
                    name            = $itemContent.attr('data-name');

                // checkCheckbox($this, checkedCallback, uncheckedCallback)
                checkCheckbox($this, function () {
                    console.log('checked')
                    // setRightItemHtml(uid, name, $selectedList)
                    setRightItemHtml(uid, name, $selectedList);

                    $itemContent.addClass('active');

                    // 更新上一级的全选 $itemContent .js-checkbox-wrap-all
                    $itemContentAll.each(function () {
                        var $item          = $(this),
                            $itemSelectAll = $item.find('.js-checkbox-wrap-all'),
                            $checkbox      = $item.find('.js-checkbox-wrap');

                        // checkSelectAll($selectAll, $checkbox)
                        checkSelectAll($itemSelectAll, $checkbox);
                    })

                }, function () {
                    $selectedList.find('.js-list-item[data-id="' + uid + '"]').remove();
                    $itemContent.removeClass('active');

                    console.log('unchecked')

                    // 更新上一级全选 $itemContentAll
                    // setCheckboxStatus($this, status, callback)
                    setCheckboxStatus($itemContentAll, 'false');
                })
            });

            // 选择全部 .js-item-content .js-checkbox-wrap-all
            $body.on('click', '.js-checkbox-wrap-all', function () {
                var $this           = $(this),
                    $ItemContent    = $this.closest('.js-item-content'),
                    $itemContentAll = $this.parents('.js-item-content'),
                    $itemSelectAll  = $ItemContent.find('.js-item-content .js-checkbox-wrap-all'),
                    $items          = $ItemContent.find('.js-checkbox-wrap'),
                    $selectedList   = $('.js-selected-list'),
                    html            = '';

                // checkCheckbox($this, checkedCallback, uncheckedCallback)
                checkCheckbox($this, function () {

                    // 更新向上的所有全选
                    $itemContentAll.each(function () {
                        var $item     = $(this),
                            $checkbox = $this.find('.js-checkbox-wrap');

                        // checkSelectAll($selectAll, $checkbox)
                        checkSelectAll($item, $checkbox);
                    });

                    // 更新该全选下的全选 etRightItemHtml(uid, name, $selectedList)
                    setCheckboxStatus($itemSelectAll, 'true');

                    // 每个员工
                    $items.each(function () {
                        var $item        = $(this),
                            $itemContent = $item.closest('.js-item-content'),
                            uid          = $itemContent.attr('data-id'),
                            name         = $itemContent.attr('data-name');

                        // setCheckboxStatus($this, status, callback)
                        setCheckboxStatus($item, 'true');

                        // setRightItemHtml(uid, name, $selectedList)
                        setRightItemHtml(uid, name, $selectedList);
                        $itemContent.addClass('active');
                    })
                }, function () {

                    // 向上/向下更新所有全选
                    setCheckboxStatus($itemContentAll, 'false');
                    setCheckboxStatus($itemSelectAll, 'false');

                    // 每个员工
                    $items.each(function () {
                        var $item        = $(this),
                            $itemContent = $item.closest('.js-item-content'),
                            uid          = $itemContent.attr('data-id');

                        // setCheckboxStatus($this, status, callback)
                        setCheckboxStatus($item, 'false');

                        $selectedList.find('.js-list-item[data-id="' + uid + '"]').remove();
                        $itemContent.removeClass('active');
                    });

                })
            });

            /*
             * 右边删除一个员工  .js-selected-list -> .js-list-item .js-selected-remove
             * .js-tree-list .js-checkbox-wrap
             */
            $body.on('click', '.js-selected-list .js-selected-remove', function () {
                var $this = $(this);

                // removeItem($removeDom)
                removeItem($this);
            });

            // 右边清空 。.js-selected-clear
            $body.on('click', '.js-selected-clear', function () {
                var $selectedItem = $(this).closest('.js-tree-panel').find('.js-selected-list .js-list-item');

                $selectedItem.each(function () {
                    var $item = $(this);

                    // removeItem($removeDom)
                    removeItem($item);
                })
            });

            // 确定按钮 返回所有的已经选择的员工对象数组
            $body.on('click', '#js-tree-submit', function () {
                var $this         = $(this),
                    $treePanel    = $this.closest('.js-tree-panel'),
                    $selectedList = $treePanel.find('.js-selected-list'),
                    selectedArr   = [];

                $selectedList.find('.js-list-item').each(function () {
                    var $item   = $(this),
                        itemObj = new Object();

                    itemObj.id   = $item.attr('data-id');
                    itemObj.name = $item.attr('data-name');

                    selectedArr.push(itemObj);
                });

                $treePanel.remove();

                return selectedArr;
            });

            // 取消 删除员工面板
            $body.on('click', '.js-tree-cancel', function () {
                var $this      = $(this),
                    $treePanel = $this.closest('.js-tree-panel');

                $treePanel.remove();
            });

            /**
             * Description: 右边移除一个员工
             * @$removeDom uid：员工对象
             */
            function removeItem($removeDom) {
                var $this       = $removeDom,
                    $listItem   = $this.closest('.js-list-item'),
                    uid         = $listItem.attr('data-id'),
                    $treePanel  = $this.closest('.js-tree-panel'),
                    $updateItem = $treePanel.find('.js-item-content.active[data-id="' + uid + '"]');

                // 该员工取消选中
                //setCheckboxStatus($this, status, callback)
                $updateItem.removeClass('active');
                setCheckboxStatus($updateItem.find('.js-checkbox-wrap'), 'false');

                // 更新向上全选
                $updateItem.each(function () {
                    var $item           = $(this),
                        $itemContentAll = $item.parents('.js-item-content');

                    // 更新向上的所有全选
                    $itemContentAll.each(function () {
                        var $item     = $(this),
                            $checkbox = $item.find('.js-checkbox-wrap');

                        // checkSelectAll($selectAll, $checkbox)
                        checkSelectAll($item, $checkbox);
                    });
                });

                // 更新选中面板
                $listItem.remove();
            }


            /**
             * Description: 右边添加一个新员工
             * @param uid：员工 id
             * @param name：员工 name
             * @param $selectedList：需要添加到的节点
             */
            function setRightItemHtml(uid, name, $selectedList) {
                var html = '';

                html += '<li class="list-item js-list-item" data-id="' + uid + '" data-name="' + name + '">';
                html += '<div class="item-content">';
                html += '<span class="text">' + name + '</span>';
                html += '<div class="item-right">';
                html += '<span class="icon icon-delcontact js-selected-remove"></span>';
                html += '</div>';
                html += '</div>';
                html += '</li>';

                $selectedList.append(html);
            }

            /**
             * Description: 判断复选框是否被选中
             * @param $this：当前复选框对象
             * @param checkedCallback：选中时的回调
             * @param uncheckedCallback：未选中的回调
             */
            function checkCheckbox($this, checkedCallback, uncheckedCallback) {
                var $checkbox = $this.find('input[type="checkbox"]');

                if($checkbox.attr('checked') == 'checked') {
                    $checkbox.prop('checked',false).removeAttr('checked');

                    uncheckedCallback && uncheckedCallback();
                }
                else {
                    $checkbox.prop('checked',true).attr('checked','checked');

                    checkedCallback && checkedCallback();
                }
            }

            /**
             * Description: 设置复选框的状态
             * @param $this：需要改变复选框对象
             * @param status：'true' or 'false'
             * @param callback: 改变状态之后的回调
             */
            function setCheckboxStatus($this, status, callback) {
                var $checkbox = $this.find('input[type="checkbox"]');

                if (status == 'true') {
                    $this.prop('checked',true);
                    $checkbox.prop('checked',true).attr('checked','checked');
                }
                else {
                    $this.prop('checked',false);
                    $checkbox.prop('checked',false).removeAttr('checked');
                }
                callback && callback($this);
            }

            /**
             * Description: 判断是否全选
             * @param $selectAll：需要更新状态的全选复选框对象
             * @param $checkbox：用来判断全选复选框状态的复选框对象 是一个array
             */
            function checkSelectAll($selectAll, $checkbox) {
                var isSelectedAll = true;

                $checkbox.each(function () {
                    var $this     = $(this),
                            $checkbox = $this.find('input[type="checkbox"]');

                    (!$this.prop('checked') || $checkbox.attr('checked') != 'checked') && (isSelectedAll = false);
                });

                // setCheckboxStatus($this, status, callback)
                isSelectedAll ? setCheckboxStatus($selectAll, 'true') : setCheckboxStatus($selectAll, 'false');
            }
        })
    </script>
</body>
</html>